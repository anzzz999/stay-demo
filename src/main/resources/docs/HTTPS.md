## HTTPS

##### 细说浏览器输入URL后发生了什么?





**当你输入域名访问一个网站的时候，背后的过程是什么?**
一般来说是分为5步。

1. DNS解析，将对应的域名解析为对应的IP地址 。
2. 根据获取的IP地址，通过三次握手建立TCP连接。
3. 通过TCP连接发起HTTP请求。
4. 服务器根据响应的HTTP请求，交给特定的处理器进行处理，并将结果和响应的视图进行返回。
5. 浏览器解析并渲染视图。

具体用到的协议：

1. 应用层：DNS 、HTTP
2. 传输层：TCP
3. 网络层：IP、ICMP、ARP

DNS解析具体过程：

1. 首先查询浏览器的DNS缓存，如果有就返回对应IP；
2. 如果没有的话，查询系统的缓存，这里会使用底层的系统调用进行查询；
3. 如果找不到，查询路由器的缓存；
4. 如果找不到就查找ISP对应的缓存记录；
5. 如果找不到，就对根域名解析服务器发起查询请求（一般本地域名服务器会缓存顶级域名服务器的地址，所以根域名解析服务器请求比较少），返回对应的IP地址。



我的理解:

本地缓存找——>系统缓存找——>路由缓存找——>服务提供商找（ISP）——>根域名解析服务器找



**七层**划分为：**应用层、表示层、会话层、传输层、网络层、数据链路层、物理层**。

**五层**划分为：**应用层、传输层、网络层、数据链路层、物理层**。





#### 1、什么是TCP的 三次握手

- 客户端首先发送一个TCP的SYN=1，Seq=x的包到服务器端口，表示我将要发送请求。
- 服务器接收后，返回一个SYN=1，ACK=x+1，Seq=y的响应包，表示我已经收到通知，告知客户端发送请求。
- 客户端接收后，返回一个ACK=y+1，Seq=z的响应包，表示我要开始发送请求，准备被接受。
- TCP连接通道建立



SYN(synchronous建立联机)   ACK(acknowledgement 确认)   Sequence number(顺序号码)



#### 2、为什么TCP链接的建立需要三次

（个人理解） 保证双方的一个消息接受发送的能力

**为了防止已经失效的连接请求报文段突然又传到服务端，因而产生错误**

**问题的本质是，信道是不可靠的，但是我们要建立可靠的连接发送可靠的数据，也就是数据传输是需要可靠的。在这个时候三次握手是一个理论上的最小值，并不是说是tcp协议要求的，而是为了满足在不可靠的信道上传输可靠的数据所要求的。**

#### 3、TCP和UDP有什么区别

- 基于连接与无连接

- TCP要求系统资源较多，UDP较少

- TCP保证数据正确性，UDP可能丢包

- TCP保证数据顺序，UDP不保证

- |              | UDP                                        | TCP                                    |
  | :----------- | :----------------------------------------- | :------------------------------------- |
  | 是否连接     | 无连接                                     | 面向连接                               |
  | 是否可靠     | 不可靠传输，不使用流量控制和拥塞控制       | 可靠传输，使用流量控制和拥塞控制       |
  | 连接对象个数 | 支持一对一，一对多，多对一和多对多交互通信 | 只能是一对一通信                       |
  | 传输方式     | 面向报文                                   | 面向字节流                             |
  | 首部开销     | 首部开销小，仅8字节                        | 首部最小20字节，最大60字节             |
  | 适用场景     | 适用于实时应用（IP电话、视频会议、直播等） | 适用于要求可靠传输的应用，例如文件传输 |



#### 常用HTTP状态码有哪些？

- 1XX 信息，服务器收到请求，需要请求者继续执行操作

  - 100 继续，客户端应继续其请求

- 2XX 成功，操作被成功接收并处理

  - 200 成功

- 3XX 重定向，需要进一步的操作以完成请求

  - 301 永久移动，请求的资源已被永久的移动到新URI
  - 302 临时移动，资源只是临时被移动，客户端应继续使用原有URI(临时性重定向)

- 4XX 客户端错误，请求包含语法错误或无法完成请求

  - 401 用户未认证
  - 403 请求拒绝
  - 404 无资源

- 5XX 服务器错误，服务器在处理请求的过程中发生了错误

  - 500 服务器内部错误
  - 501 服务器不支持请求的功能，无法完成请求
  - 502 无效响应

  

#### 关闭TCP链接

### 过程

- 浏览器接收到http相应后，根据情况选择关闭TCP连接或者保留重用

### 问题

#### 1、关闭TCP连接的四次握手过程

- 主动方发送fin =1，ack=z，seq=x
- 被动方发送ack=x+1，seq=z
- 被动方发送fin =1，ack=x，seq=y
- 主动方发送ack=y，seq=x

#### 2、关闭TCP连接为什么需要四次握手

TCP没有半开方法的传输方法，但是有半关传输方法



　**加密算法** --- **RSA(混合加密机制)**

　　　　(1)共享密匙加密: 公开密匙加密解密,但是无法保证安全发送密匙

　　　　(2)公开密匙加密: 公开密匙加密,私有密匙解密

　　　　HTTPS:混合加密机制: 结合对称加密和非对称加密技术

　　　　**用对称加密生成的密钥对通信数据加密**

　　　　**用非对称加密生成的公钥对密钥加密**

　　　　**这样在保证密钥的安全性下,提高了效率**

　　　　**Q:HTTP与HTTPS区别?**

　　　　**A: 1.HTTPS需要申请购买CA证书, HTTP不需要**

　　　　　 **2.HTTP是明文传输,不安全, HTTPS是在HTTP基础上加了SSL层,更安全**

　　　　　 **3.HTTPS效率低,HTTP效率高**

 

　　　　**Q:HTTPS传输过程?**

　　　　**A:客户端发起 HTTPS 请求,服务端返回证书,客户端对证书验证,验证通过后本地生成用于改造对称加密算法的随机数,通过证书中的公钥对随机数进行加密传输到服务端，服务端接收后通过私钥解密得到随机数，之后的数据交互通过对称加密算法进行加解密。**



个人理解：

客户端发起https请求，服务端首先返回证书，通过第三方客户端对证书进行验证，再利用证书上的公钥对随机数进行加密传输到服务端，服务器接收到之后通过私钥解密得到随机数，之后就通过**对称加密**进行传输。

 

　　　　**Q:为什么需要证书?**

　　　　**A:防止中间人攻击,验证服务器身份**

　　　

　　　　**Q:怎么防止的篡改?**

　　　　**A:证书是公开的,虽然中间人可以拿到证书,但私钥无法获取,公钥无法推断出私钥,所以篡改后不能用私钥加密,强行加密客户也无法解密,强行修改内容,会导致证书内容与签名中的指纹不匹配**

